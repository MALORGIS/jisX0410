<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src\meshSchema.ts</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">src/</a> meshSchema.ts
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>97/97</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>10/10</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>14/14</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>94/94</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197</td><td class="line-coverage quiet"><span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">33×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">30×</span>
<span class="cline-any cline-yes">30×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">30×</span>
<span class="cline-any cline-yes">27×</span>
<span class="cline-any cline-yes">27×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1337240×</span>
<span class="cline-any cline-yes">1337240×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1337240×</span>
<span class="cline-any cline-yes">1337240×</span>
<span class="cline-any cline-yes">1337240×</span>
<span class="cline-any cline-yes">1337240×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2672926×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2672926×</span>
<span class="cline-any cline-yes">2672926×</span>
<span class="cline-any cline-yes">2672926×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">527106×</span>
<span class="cline-any cline-yes">527106×</span>
<span class="cline-any cline-yes">527106×</span>
<span class="cline-any cline-yes">527106×</span>
<span class="cline-any cline-yes">527106×</span>
<span class="cline-any cline-yes">527106×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">450×</span>
<span class="cline-any cline-yes">450×</span>
<span class="cline-any cline-yes">450×</span>
<span class="cline-any cline-yes">450×</span>
<span class="cline-any cline-yes">450×</span>
<span class="cline-any cline-yes">450×</span>
<span class="cline-any cline-yes">450×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1138105×</span>
<span class="cline-any cline-yes">1138105×</span>
<span class="cline-any cline-yes">1138105×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1138105×</span>
<span class="cline-any cline-yes">1138105×</span>
<span class="cline-any cline-yes">1138105×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4338587×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4338587×</span>
<span class="cline-any cline-yes">4338587×</span>
<span class="cline-any cline-yes">4338587×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4338587×</span>
<span class="cline-any cline-yes">4338587×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4338587×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">namespace jisX0410
{
  /** メッシュ情報定義 */
  export interface IMeshInfo
  {
    /** メッシュコード */
    meshCode: string;
    /** 緯度 */
    lat: number;
    /** 経度 */
    lon: number;
  }//end class
&nbsp;
  /** メッシュ定義の管理クラス */
  export class meshSchema
  {
    /** 緯度差 */
    public widthDD: number;
    /** 経度差 */
    public heightDD: number;
    /** 分割数 */
    public splitCount: number;
    /** 親メッシュ定義 */
    public parent: meshSchema;
    /** 説明用のラベル */
    public label: string;
    /** メッシュコードの分割文字列 */
    public splitString:string;
&nbsp;
    /** メッシュコード取得関数 */
    public getMeshCode: (latlon:[number,number]) =&gt; IMeshInfo;
&nbsp;
    /**
     * コンストラクタ
     * @param parent  親メッシュ定義
     * @param splitCount 分割数
     */
    public constructor(parent: meshSchema = undefined, splitCount:number = undefined)
    {
      this.parent = parent;
      this.splitCount = splitCount;
&nbsp;
      if (parent){
        this.widthDD = parent.widthDD / splitCount;
        this.heightDD = parent.heightDD / splitCount;
      }//end if
    }//end method
&nbsp;
    /**
     * 標準的なメッシュ定義の返却
     */
    public static createStandardMesh() : Array&lt;meshSchema&gt; {
&nbsp;
      //1次メッシュコード生成用のコード
      let mesh1_getCode: (latlon:[number,number]) =&gt; IMeshInfo  = 
      function(latlon: [number, number]): IMeshInfo{
        let r = Math.round(Math.floor(latlon[0] * 15.0 / 10.0));
        let c = Math.round(Math.floor(latlon[1] - 100.0));
&nbsp;
        //メッシュコード
        let code = String(r) + String(c);
        let lat = r / 15.0 * 10.0;
        let lon = c + 100.0;
        return { meshCode: code, lat: lat, lon:lon };
      };
      //2-3次メッシュコード生成用のコード
      let mesh2_3_getCode :(latlon:[number,number]) =&gt; IMeshInfo =
      function(latlon: [number, number]): IMeshInfo{
        let thisObj = (&lt;meshSchema&gt;this);
&nbsp;
        return meshSchema._getCodeBase(thisObj, latlon, function(preMeshInfo:IMeshInfo, r:number,c:number){
          let thisObj = (&lt;meshSchema&gt;this);
          return preMeshInfo.meshCode + thisObj.splitString + String(r) + String(c);
        });
      };
      //3-6次メッシュコードと5倍地域メッシュの生成用コード
      let mesh4_6_getCode :(latlon:[number, number]) =&gt; IMeshInfo =
      function(latlon: [number, number]): IMeshInfo{
        let thisObj = (&lt;meshSchema&gt;this);
        return meshSchema._getCodeBase(thisObj, latlon, function(preMeshInfo:IMeshInfo, r:number,c:number){
          let thisObj = (&lt;meshSchema&gt;this);
          let code = r &lt; 1 ? String(c + 1) : String(c + 1 + 2);
          code = preMeshInfo.meshCode + thisObj.splitString + code;
          return code;
        });
      };
      //2倍地域メッシュの生成コード
      let mesh3_2_getCode:(latlon:[number, number]) =&gt; IMeshInfo =
      function(latlon: [number, number]): IMeshInfo{
        let thisObj = (&lt;meshSchema&gt;this);
        return meshSchema._getCodeBase(thisObj, latlon, function(preMeshInfo:IMeshInfo, r:number,c:number){
          let thisObj = (&lt;meshSchema&gt;this);
          const MESH_ID = ["0","2","4","6","8"];
          let code = MESH_ID[r] + MESH_ID[c] + '5';
          code = preMeshInfo.meshCode + thisObj.splitString + code;
          return  code;
        });
      };
      //10分の1・20分の1細分区画のメッシュコード生成コード ( 明確な規定がなさそうので適当にRCを文字化 )
      let mesh7_8_getCode:(latlon:[number, number]) =&gt; IMeshInfo =
      function(latlon: [number, number]): IMeshInfo{
        let thisObj = (&lt;meshSchema&gt;this);
        return meshSchema._getCodeBase(thisObj, latlon, function(preMeshInfo:IMeshInfo, r:number,c:number){
          let thisObj = (&lt;meshSchema&gt;this);
          //文字列化して0埋め
          let code = ('00' + String(r)).slice(-2) + thisObj.splitString + ('00' + String(c)).slice(-2);
          code = preMeshInfo.meshCode + thisObj.splitString + code;
          return  code;
        });
      };
&nbsp;
      let mesh1 = new meshSchema();
      mesh1.label = "第1次地域区画(約80km四方)";
      mesh1.widthDD = 1;
      mesh1.heightDD = 2 / 3;
      mesh1.getMeshCode = mesh1_getCode.bind(mesh1);
&nbsp;
      let mesh2 = new meshSchema(mesh1, 8);
      mesh2.label = "第2次地域区画(約10km四方)";
      mesh2.splitString = "-";
      mesh2.getMeshCode = mesh2_3_getCode.bind(mesh2);
&nbsp;
      let mesh3_5 = new meshSchema(mesh2, 2);
      mesh3_5.label = "5倍地域メッシュ(約5km四方)";
      mesh3_5.splitString = "-";
      mesh3_5.getMeshCode = mesh4_6_getCode.bind(mesh3_5);
&nbsp;
      let mesh3_2 = new meshSchema(mesh2, 5);
      mesh3_2.label = "2倍地域メッシュ(約2km四方)";
      mesh3_2.splitString = "-";
      mesh3_2.getMeshCode = mesh3_2_getCode.bind(mesh3_2);
      
      let mesh3 = new meshSchema(mesh2, 10);
      mesh3.label = "基準地域メッシュ(約1km四方)";
      mesh3.splitString = "-";
      mesh3.getMeshCode = mesh2_3_getCode.bind(mesh3);
&nbsp;
      let mesh4 = new meshSchema(mesh3, 2);
      mesh4.label = "2分の1地域メッシュ(約500m四方)";
      mesh4.splitString = "-";
      mesh4.getMeshCode = mesh4_6_getCode.bind(mesh4);
&nbsp;
      let mesh5 = new meshSchema(mesh4, 2);
      mesh5.label = "4分の1地域メッシュ(約250m四方)";
      mesh5.splitString = "-";
      mesh5.getMeshCode = mesh4_6_getCode.bind(mesh5);
&nbsp;
      let mesh6 = new meshSchema(mesh5, 2);
      mesh6.label = "8分の1地域メッシュ(約125m四方)";
      mesh6.splitString = "-";
      mesh6.getMeshCode = mesh4_6_getCode.bind(mesh6);
&nbsp;
      let mesh7 = new meshSchema(mesh3, 10);
      mesh7.label = "10分の1 細分区画(約100m四方)";
      mesh7.splitString = "_";
      mesh7.getMeshCode = mesh7_8_getCode.bind(mesh7);
&nbsp;
      let mesh8 = new meshSchema(mesh3, 20);
      mesh8.label = "20分の1 細分区画(約50m四方)";
      mesh8.splitString = "_";
      mesh8.getMeshCode = mesh7_8_getCode.bind(mesh8);
&nbsp;
      //定義の返却
      return [
        // 0   1      2        3        4      5      6      7      8      9
        mesh1, mesh2, mesh3_5, mesh3_2, mesh3, mesh4, mesh5, mesh6, mesh7, mesh8
      ];
&nbsp;
    }//end mehtod
&nbsp;
&nbsp;
    /**
     * メッシュコード取得用の標準処理定義
     * @param thisObj メッシュスキーマ
     * @param latlon 緯度経度
     * @param getCoods メッシュコード取得処理
     * @returns メッシュ情報
     */
    private static _getCodeBase(thisObj:meshSchema , latlon:[number,number] ,getCoods: (preMeshInfo:IMeshInfo, r:number, c:number)=&gt; string): IMeshInfo {
&nbsp;
      let preMeshInfo = thisObj.parent.getMeshCode(latlon);
&nbsp;
      let r:number = Math.floor((latlon[0] - preMeshInfo.lat) / thisObj.heightDD);
      let c:number = Math.floor((latlon[1] - preMeshInfo.lon) / thisObj.widthDD);
      let code:string = getCoods.bind(thisObj)(preMeshInfo,r,c);
&nbsp;
      let lat:number = preMeshInfo.lat + (r * thisObj.heightDD);
      let lon:number = preMeshInfo.lon + (c * thisObj.widthDD);
      
      return { meshCode: code, lat:lat, lon:lon };
    }//end method
  }//end class
&nbsp;
&nbsp;
&nbsp;
&nbsp;
}//end namespace</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sun Jan 07 2018 18:25:17 GMT+0900 (東京 (標準時))
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
